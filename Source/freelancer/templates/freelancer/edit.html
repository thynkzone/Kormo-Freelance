{% extends 'layouts/default/base.html' %}
{% load static %}

{% block title %}Edit Profile - {{ freelancer.fullname }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Profile Completion Bar -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
            <div class="px-6 py-4">
                <div class="flex items-center justify-between mb-2">
                    <h2 class="text-lg font-semibold text-gray-900">Profile Completion</h2>
                    <span class="text-sm font-medium text-gray-600">{{ freelancer.get_profile_completion }}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div class="bg-green-600 h-2.5 rounded-full progress-bar" data-progress="{{ freelancer.get_profile_completion }}"></div>
                </div>
                <p class="mt-2 text-sm text-gray-500">Complete your profile to increase your visibility and chances of getting hired.</p>
            </div>
        </div>

        <!-- Subscription Section -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
            <div class="px-6 py-8 border-b border-gray-100">
                <h2 class="text-2xl font-bold text-gray-900">Subscription</h2>
                <p class="mt-2 text-sm text-gray-600">Manage your plan and see your monthly usage.</p>
            </div>
            <div class="p-6">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                    <div>
                        <p class="text-sm font-medium text-gray-900 mb-1">Current Plan:
                            <span class="inline-block px-2 py-1 rounded bg-gray-100 text-green-700 font-semibold ml-2">
                                {{ freelancer.get_current_subscription.plan.get_name_display|default:'Free Plan' }}
                            </span>
                            {% if freelancer.get_current_subscription.status == 'pending' %}
                                <span class="ml-2 text-xs text-yellow-600">(Pending Verification)</span>
                            {% elif freelancer.get_current_subscription.status == 'expired' %}
                                <span class="ml-2 text-xs text-red-600">(Expired)</span>
                            {% elif freelancer.get_current_subscription.status == 'active' %}
                                <span class="ml-2 text-xs text-green-600">(Active)</span>
                            {% endif %}
                        </p>
                        {% if freelancer.get_current_subscription %}
                            <p class="text-sm text-gray-700 mt-2">
                                Start Date: <span class="font-semibold">{{ freelancer.get_current_subscription.start_date|date:"F j, Y" }}</span>
                            </p>
                            {% if freelancer.get_current_subscription.end_date %}
                                <p class="text-sm text-gray-700">
                                    End Date: <span class="font-semibold">{{ freelancer.get_current_subscription.end_date|date:"F j, Y" }}</span>
                                </p>
                            {% endif %}
                        {% endif %}
                        <p class="text-sm text-gray-700 mt-2">
                            Proposals this month:
                            <span class="font-semibold">{{ freelancer.get_proposals_this_month }}/{{ freelancer.get_proposal_limit }}</span>
                        </p>
                        <p class="text-sm text-gray-700">
                            Jobs posted this month:
                            <span class="font-semibold">{{ freelancer.get_jobs_posted_this_month }}/{{ freelancer.get_job_post_limit }}</span>
                        </p>
                    </div>
                    {% if not freelancer.get_current_subscription or freelancer.get_current_subscription.plan.name != 'pro' %}
                        <a href="{% url 'freelancer:plans' %}" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            {% if freelancer.get_current_subscription %}
                                Upgrade Plan
                            {% else %}
                                Upgrade
                            {% endif %}
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Earnings Section -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
            <div class="px-6 py-8 border-b border-gray-100">
                <h2 class="text-2xl font-bold text-gray-900">Earnings & Expenses</h2>
                <p class="mt-2 text-sm text-gray-600">Your total earnings, pending payments, and expenses</p>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Total Earnings -->
                    <div class="bg-gray-50 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-medium text-gray-900">Total Earnings</h3>
                                <p class="mt-2 text-3xl font-bold text-green-600">৳{{ total_earned|floatformat:0 }}</p>
                                <p class="mt-1 text-sm text-gray-500">From completed jobs</p>
                            </div>
                            <div class="flex flex-col items-end gap-2">
                                <div class="h-12 w-12 rounded-full bg-green-100 flex items-center justify-center">
                                    <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pending Earnings -->
                    <div class="bg-gray-50 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-900">Pending Earnings</p>
                                <p class="mt-2 text-3xl font-bold text-yellow-600">৳{{ pending_earnings|floatformat:0 }}</p>
                                <p class="mt-1 text-sm text-gray-500">From in-progress jobs</p>
                            </div>
                            <div class="h-12 w-12 rounded-full bg-yellow-100 flex items-center justify-center">
                                <svg class="h-6 w-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Total Expenses -->
                    <div class="bg-gray-50 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-900">Total Expenses</p>
                                <p class="mt-2 text-3xl font-bold text-red-600">৳{{ total_expenses|floatformat:0 }}</p>
                                <p class="mt-1 text-sm text-gray-500">Jobs + Subscriptions</p>
                            </div>
                            <div class="h-12 w-12 rounded-full bg-red-100 flex items-center justify-center">
                                <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span></span>
                    <div class="flex gap-3">
                        <a href="{% url 'freelancer:download_expenses' freelancer.id %}" class="inline-flex items-center mt-4 px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                            <i class="fas fa-file-invoice-dollar mr-1.5"></i>
                            Download Report
                        </a>
                        <a href="{% url 'freelancer:download_earnings' freelancer.id %}" class="inline-flex items-center mt-4 px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            <i class="fas fa-file-invoice-dollar mr-1.5"></i>
                            Download Statement
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Email Change Section -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
            <div class="px-6 py-8 border-b border-gray-100">
                <h2 class="text-2xl font-bold text-gray-900">Email Address</h2>
                <p class="mt-2 text-sm text-gray-600">Update your email address.</p>
            </div>
            <div class="p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-900">Current Email</p>
                        <p class="mt-1 text-sm text-gray-500" id="masked-email" data-email="{{ freelancer.user.email }}">
                            <script>
                                (function() {
                                    const emailElement = document.getElementById('masked-email');
                                    const email = emailElement.getAttribute('data-email');
                                    
                                    if (email && email.includes('@')) {
                                        const parts = email.split('@');
                                        const username = parts[0];
                                        const domain = parts[1];
                                        
                                        let maskedUsername;
                                        if (username.length > 4) {
                                            const hiddenChars = username.length - 4; // 2 from start + 2 from end
                                            const stars = '*'.repeat(hiddenChars);
                                            maskedUsername = username.substring(0, 2) + stars + username.substring(username.length - 2);
                                        } else {
                                            const hiddenChars = username.length - 2; // 1 from start + 1 from end
                                            const stars = '*'.repeat(hiddenChars);
                                            maskedUsername = username.substring(0, 1) + stars + username.substring(username.length - 1);
                                        }
                                        
                                        emailElement.textContent = maskedUsername + '@' + domain;
                                    } else {
                                        emailElement.textContent = email;
                                    }
                                })();
                            </script>
                        </p>
                    </div>
                    <a href="{% url 'accounts:change_email' %}" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Change Email
                    </a>
                </div>
            </div>
        </div>

        <!-- bKash Account Section -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
            <div class="px-6 py-8 border-b border-gray-100">
                <h2 class="text-2xl font-bold text-gray-900">bKash Account</h2>
                <p class="mt-2 text-sm text-gray-600">Your bKash account number (Personal Only) - Not shown publicly</p>
            </div>
            <div class="p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-900">Current bKash Account</p>
                        <p class="mt-1 text-sm text-gray-500" id="masked-bkash" data-account="{{ freelancer.bkash_account }}">
                            <script>
                                (function() {
                                    const bkashElement = document.getElementById('masked-bkash');
                                    const account = bkashElement.getAttribute('data-account');
                                    
                                    if (account && account.length > 7) {
                                        const hiddenChars = account.length - 7; // 3 from start + 4 from end
                                        const stars = '*'.repeat(hiddenChars);
                                        const maskedAccount = account.substring(0, 3) + stars + account.substring(account.length - 4);
                                        bkashElement.textContent = maskedAccount;
                                    } else if (account && account.length > 0) {
                                        const hiddenChars = account.length - 2; // 1 from start + 1 from end
                                        const stars = '*'.repeat(hiddenChars);
                                        const maskedAccount = account.substring(0, 1) + stars + account.substring(account.length - 1);
                                        bkashElement.textContent = maskedAccount;
                                    } else {
                                        bkashElement.textContent = account || '';
                                    }
                                })();
                            </script>
                        </p>
                    </div>
                    <button type="button" onclick="toggleBkashEdit()" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Change
                    </button>
                </div>
                <form method="post" action="{% url 'freelancer:edit' pk=freelancer.pk %}" id="bkashForm" class="mt-4 max-w-md hidden">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="bkash">
                    <div class="flex items-center gap-4">
                        {{ bkash_form.bkash_account }}
                        <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            Save
                        </button>
                    </div>
                    {% if bkash_form.bkash_account.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ bkash_form.bkash_account.errors }}</p>
                    {% endif %}
                </form>
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        const bkashInput = document.getElementById('id_bkash_account');
                        if (bkashInput) {
                            bkashInput.value = '';
                            bkashInput.placeholder = 'Enter new bKash account number';
                        }
                    });
                </script>
            </div>
        </div>

        <!-- Main Profile Form -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
            <div class="px-6 py-8 border-b border-gray-100">
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Edit Profile</h1>
                        <p class="mt-2 text-sm text-gray-600">Update your basic profile information.</p>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <a href="{% url 'freelancer:qr_code' pk=freelancer.pk %}?download=true" class="inline-flex items-center justify-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            <svg class="h-5 w-5 mr-2 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" />
                            </svg>
                            Download QR Code
                        </a>
                        <a href="{% url 'freelancer:detail' pk=freelancer.pk %}" class="inline-flex items-center justify-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            <svg class="h-5 w-5 mr-2 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            View Public Profile
                        </a>
                    </div>
                </div>
            </div>

            <form method="post" action="{% url 'freelancer:edit' pk=freelancer.pk %}" enctype="multipart/form-data" class="divide-y divide-gray-100" id="mainForm">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="main" id="formType">
                
                <!-- Profile Image Section -->
                <div class="p-6">
                    <div class="flex flex-col sm:flex-row sm:items-center gap-6">
                        <div class="shrink-0">
                            <div class="h-32 w-32 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden">
                                <img id="profile-image-preview" src="{% if freelancer.profile_image %}{{ freelancer.profile_image.url }}{% else %}https://cdn.pixabay.com/photo/2021/07/02/04/48/user-6380868_1280.png{% endif %}" alt="Profile" class="h-full w-full object-cover">
                            </div>
                        </div>
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700">Profile Image</label>
                            <div class="mt-1 flex flex-col sm:flex-row gap-4">
                                <div class="relative">
                                    <input type="file" name="profile_image" id="id_profile_image" class="hidden" accept="image/*" onchange="previewImage(this)">
                                    <button type="button" onclick="document.getElementById('id_profile_image').click()" class="w-full sm:w-auto inline-flex items-center justify-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                        <svg class="h-5 w-5 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                        </svg>
                                        Change photo
                                    </button>
                                </div>
                                {% if freelancer.profile_image %}
                                <button type="button" onclick="removeImage()" class="w-full sm:w-auto inline-flex items-center justify-center px-4 py-2 border border-red-300 shadow-sm text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                    <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                    Remove
                                </button>
                                {% endif %}
                            </div>
                            <p class="mt-2 text-sm text-gray-500">JPG, PNG or GIF. Max size of 10MB</p>
                        </div>
                    </div>
                </div>

                <!-- Basic Information -->
                <div class="p-6">
                    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                        <div>
                            {{ form.category }}
                        </div>

                        <div>
                            <div class="mt-1 relative rounded-md shadow-sm">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 sm:text-sm">৳</span>
                                </div>
                                {{ form.hourly_rate }}
                            </div>
                        </div>

                        <div class="sm:col-span-2">
                            {{ form.description }}
                        </div>
                    </div>
                </div>

                <!-- Links Section -->
                <div class="p-6">
                        <div class="sm:col-span-3">
                            <label class="inline-flex items-center">
                                {{ form.is_not_available }}
                                <span class="ml-2 text-sm font-bold text-red-600">Not available for hiring</span>
                            </label>
                        </div>
                </div>

                <!-- Form Actions -->
                <div class="px-6 py-4 bg-gray-50 flex justify-end space-x-3">
                    <a href="{% url 'freelancer:detail' pk=freelancer.pk %}" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Cancel
                    </a>
                    <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>

        <script>
            const defaultImagePath = "{% static 'images/default-profile.png' %}";

            window.previewImage = function(input) {
                const file = input.files[0];
                const preview = document.getElementById('profile-image-preview');
                const removeButton = document.querySelector('button[onclick="removeImage()"]');

                if (!file) {
                    return;
                }

                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file (JPG, PNG, GIF)');
                    return;
                }

                if (file.size > 10 * 1024 * 1024) {
                    alert('Image size should be less than 10MB');
                    return;
                }

                const reader = new FileReader();
                
                reader.onload = function(e) {
                    if (preview) {
                        preview.src = e.target.result;
                        if (removeButton) {
                            removeButton.classList.remove('hidden');
                        }
                    }
                };
                
                reader.onerror = function(error) {
                    console.error('Error reading file:', error);
                };
                
                reader.readAsDataURL(file);
            };

            window.removeImage = function() {
                const input = document.getElementById('id_profile_image');
                const preview = document.getElementById('profile-image-preview');
                const removeButton = document.querySelector('button[onclick="removeImage()"]');

                if (input) input.value = '';
                if (preview) preview.src = defaultImagePath;
                if (removeButton) removeButton.classList.add('hidden');
            };

            // Set progress bar width
            document.addEventListener('DOMContentLoaded', function() {
                const progressBar = document.querySelector('.progress-bar');
                if (progressBar) {
                    const progress = progressBar.getAttribute('data-progress');
                    progressBar.style.width = progress + '%';
                }
            });

            function toggleBkashEdit() {
                const editForm = document.getElementById('bkashForm');
                editForm.classList.toggle('hidden');
                if (!editForm.classList.contains('hidden')) {
                    document.getElementById('id_bkash_account').focus();
                }
            }

            // Add event listener for the main form submit
            document.getElementById('mainForm').addEventListener('submit', function(e) {
                const formType = document.getElementById('formType');
                if (formType.value === 'main') {
                    // This is the main form submission, let it proceed normally
                    return true;
                }
            });
        </script>

        <!-- Skills Section -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
            <div class="px-6 py-8 border-b border-gray-100 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">Skills</h2>
                    <p class="mt-2 text-sm text-gray-600">Manage your professional skills.</p>
                </div>
                <a href="{% url 'freelancer:add_skill' pk=freelancer.pk %}" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                    Add Skill
                </a>
            </div>

            <div class="p-6">
                <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
                    {% for skill in freelancer.skills.all %}
                    <div class="bg-gray-50 rounded-lg p-4 flex justify-between items-center">
                        <div>
                            <h3 class="text-sm font-medium text-gray-900">{{ skill.skill.name }}</h3>
                            <p class="text-sm text-gray-500">{{ skill.get_level_display }}</p>
                        </div>
                        <div class="flex space-x-2">
                            <a href="{% url 'freelancer:edit_skill' pk=freelancer.pk skill_id=skill.pk %}" class="text-green-600 hover:text-green-700">
                                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                </svg>
                            </a>
                            <form method="post" action="{% url 'freelancer:delete_skill' pk=freelancer.pk skill_id=skill.pk %}" class="inline">
                                {% csrf_token %}
                                <button type="submit" class="text-red-600 hover:text-red-700">
                                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </form>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-span-full text-center py-4 text-gray-500">
                        No skills added yet.
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Experience Section -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
            <div class="px-6 py-8 border-b border-gray-100 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">Experience</h2>
                    <p class="mt-2 text-sm text-gray-600">Manage your work experience.</p>
                </div>
                <a href="{% url 'freelancer:add_experience' pk=freelancer.pk %}" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                    Add Experience
                </a>
            </div>

            <div class="p-6">
                <div class="space-y-6">
                    {% for experience in freelancer.experiences.all %}
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-lg font-medium text-gray-900">{{ experience.position }}</h3>
                                <p class="text-sm text-gray-500">{{ experience.company }}</p>
                                <p class="text-sm text-gray-500">{{ experience.location }}</p>
                                <p class="text-sm text-gray-500">
                                    {{ experience.start_date|date:"F Y" }} - 
                                    {% if experience.current %}
                                        Present
                                    {% else %}
                                        {{ experience.end_date|date:"F Y" }}
                                    {% endif %}
                                </p>
                                {% if experience.description %}
                                <p class="mt-2 text-sm text-gray-600">{{ experience.description }}</p>
                                {% endif %}
                            </div>
                            <div class="flex space-x-2">
                                <a href="{% url 'freelancer:edit_experience' pk=freelancer.pk experience_id=experience.pk %}" class="text-green-600 hover:text-green-700">
                                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </a>
                                <form method="post" action="{% url 'freelancer:delete_experience' pk=freelancer.pk experience_id=experience.pk %}" class="inline">
                                    {% csrf_token %}
                                    <button type="submit" class="text-red-600 hover:text-red-700">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-4 text-gray-500">
                        No experience added yet.
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Education Section -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
            <div class="px-6 py-8 border-b border-gray-100 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">Education</h2>
                    <p class="mt-2 text-sm text-gray-600">Manage your educational background.</p>
                </div>
                <a href="{% url 'freelancer:add_education' pk=freelancer.pk %}" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                    Add Education
                </a>
            </div>

            <div class="p-6">
                <div class="space-y-6">
                    {% for education in freelancer.education.all %}
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-lg font-medium text-gray-900">{{ education.degree }}</h3>
                                <p class="text-sm text-gray-500">{{ education.institution }}</p>
                                {% if education.field_of_study %}
                                <p class="text-sm text-gray-500">{{ education.field_of_study }}</p>
                                {% endif %}
                                <p class="text-sm text-gray-500">
                                    {{ education.start_date|date:"F Y" }} - 
                                    {% if education.current %}
                                        Present
                                    {% else %}
                                        {{ education.end_date|date:"F Y" }}
                                    {% endif %}
                                </p>
                                {% if education.description %}
                                <p class="mt-2 text-sm text-gray-600">{{ education.description }}</p>
                                {% endif %}
                            </div>
                            <div class="flex space-x-2">
                                <a href="{% url 'freelancer:edit_education' pk=freelancer.pk education_id=education.pk %}" class="text-green-600 hover:text-green-700">
                                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </a>
                                <form method="post" action="{% url 'freelancer:delete_education' pk=freelancer.pk education_id=education.pk %}" class="inline">
                                    {% csrf_token %}
                                    <button type="submit" class="text-red-600 hover:text-red-700">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-4 text-gray-500">
                        No education added yet.
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Certifications Section -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
            <div class="px-6 py-8 border-b border-gray-100 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">Certifications</h2>
                    <p class="mt-2 text-sm text-gray-600">Manage your professional certifications.</p>
                </div>
                <a href="{% url 'freelancer:add_certification' pk=freelancer.pk %}" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                    Add Certification
                </a>
            </div>

            <div class="p-6">
                <div class="space-y-6">
                    {% for certification in freelancer.certifications.all %}
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-lg font-medium text-gray-900">{{ certification.name }}</h3>
                                <p class="text-sm text-gray-500">{{ certification.issuing_organization }}</p>
                                <p class="text-sm text-gray-500">
                                    Issued: {{ certification.issue_date|date:"F Y" }}
                                    {% if certification.expiry_date %}
                                        <br>Expires: {{ certification.expiry_date|date:"F Y" }}
                                    {% endif %}
                                </p>
                                {% if certification.credential_id %}
                                <p class="text-sm text-gray-500">Credential ID: {{ certification.credential_id }}</p>
                                {% endif %}
                                {% if certification.credential_url %}
                                <a href="{{ certification.credential_url }}" target="_blank" class="text-sm text-green-600 hover:text-green-700">View Credential</a>
                                {% endif %}
                            </div>
                            <div class="flex space-x-2">
                                <a href="{% url 'freelancer:edit_certification' pk=freelancer.pk certification_id=certification.pk %}" class="text-green-600 hover:text-green-700">
                                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </a>
                                <form method="post" action="{% url 'freelancer:delete_certification' pk=freelancer.pk certification_id=certification.pk %}" class="inline">
                                    {% csrf_token %}
                                    <button type="submit" class="text-red-600 hover:text-red-700">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-4 text-gray-500">
                        No certifications added yet.
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Projects Section -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="px-6 py-8 border-b border-gray-100 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">Projects</h2>
                    <p class="mt-2 text-sm text-gray-600">Manage your portfolio projects.</p>
                </div>
                <a href="{% url 'freelancer:add_project' pk=freelancer.pk %}" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                    Add Project
                </a>
            </div>

            <div class="p-6">
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                    {% for project in freelancer.projects.all %}
                    <div class="bg-gray-50 rounded-lg overflow-hidden">
                        {% if project.image %}
                        <img src="{{ project.image.url }}" alt="{{ project.title }}" class="w-full h-48 object-cover">
                        {% endif %}
                        <div class="p-4">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900">{{ project.title }}</h3>
                                    <p class="text-sm text-gray-500">
                                        {{ project.start_date|date:"F Y" }} - 
                                        {% if project.current %}
                                            Present
                                        {% else %}
                                            {{ project.end_date|date:"F Y" }}
                                        {% endif %}
                                    </p>
                                    {% if project.url %}
                                    <a href="{{ project.url }}" target="_blank" class="text-sm text-green-600 hover:text-green-700">View Project</a>
                                    {% endif %}
                                    <p class="mt-2 text-sm text-gray-600">{{ project.description }}</p>
                                </div>
                                <div class="flex space-x-2">
                                    <a href="{% url 'freelancer:edit_project' pk=freelancer.pk project_id=project.pk %}" class="text-green-600 hover:text-green-700">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                        </svg>
                                    </a>
                                    <form method="post" action="{% url 'freelancer:delete_project' pk=freelancer.pk project_id=project.pk %}" class="inline">
                                        {% csrf_token %}
                                        <button type="submit" class="text-red-600 hover:text-red-700">
                                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                            </svg>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-span-full text-center py-4 text-gray-500">
                        No projects added yet.
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Danger Zone -->
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="px-6 py-8 border-b border-gray-100">
            <h2 class="text-2xl font-bold text-red-600">Danger Zone</h2>
            <p class="mt-2 text-sm text-gray-600">Once you delete your profile, there is no going back. Please be certain.</p>
        </div>
        <div class="p-6">
            <form method="post" action="{% url 'freelancer:delete' pk=freelancer.pk %}" id="deleteProfileForm">
                {% csrf_token %}
                <button type="button" onclick="openDeleteModal()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium transition-colors">
                    Delete Profile
                </button>
            </form>
        </div>
    </div>
</div>

<!-- Delete Profile Modal -->
<div id="deleteProfileModal" class="fixed inset-0 bg-gray-500 bg-opacity-75 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
        <div class="text-center">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Delete Profile</h3>
            <p class="text-sm text-gray-500 mb-4">This action cannot be undone. Please type "Delete My Profile" to confirm.</p>
            
            <input type="text" id="deleteConfirmation" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 mb-4" placeholder="Type 'Delete My Profile'">
            
            <div class="flex justify-end space-x-3">
                <button type="button" onclick="closeDeleteModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    Cancel
                </button>
                <button type="button" onclick="confirmDelete()" class="px-4 py-2 border border-transparent rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500" disabled id="confirmDeleteBtn">
                    Delete Profile
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    function openDeleteModal() {
        document.getElementById('deleteProfileModal').classList.remove('hidden');
        document.getElementById('deleteConfirmation').value = '';
        document.getElementById('confirmDeleteBtn').disabled = true;
    }

    function closeDeleteModal() {
        document.getElementById('deleteProfileModal').classList.add('hidden');
    }

    function confirmDelete() {
        const confirmationText = document.getElementById('deleteConfirmation').value;
        if (confirmationText === 'Delete My Profile') {
            document.getElementById('deleteProfileForm').submit();
        }
    }

    // Enable/disable delete button based on input
    document.getElementById('deleteConfirmation').addEventListener('input', function(e) {
        const confirmBtn = document.getElementById('confirmDeleteBtn');
        confirmBtn.disabled = e.target.value !== 'Delete My Profile';
    });

    // Close modal when clicking outside
    document.getElementById('deleteProfileModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeDeleteModal();
        }
    });
</script>

{% endblock %} 